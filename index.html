<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ESLM ‚Äì Terrain interactif</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { font-family: Arial; margin: 0; background: #111; color: yellow; }
    header { display: flex; align-items: center; padding: 10px; background: black; }
    header img { height: 40px; margin-right: 15px; }
    h1 { margin: 0; font-size: 1.5em; }
    .controls { padding: 10px; background: #222; display: flex; align-items: center; gap: 10px; }
    .terrain { background: url('https://i.postimg.cc/k4jZTVr8/terrain-pro.png') no-repeat center/contain; height: 80vh; position: relative; margin: 10px; border: 3px solid yellow; }
    .player { position: absolute; padding: 4px 8px; background: black; border: 1px solid yellow; border-radius: 6px; font-size: 12px; text-align: center; }
    .rempla√ßants { padding: 10px; background: #222; margin: 10px; border-radius: 6px; }
    select, button { padding: 5px; font-size: 1em; }
  </style>
</head>
<body>
  <header>
    <img src="https://i.postimg.cc/15j1R5RH/logo9.png" alt="Logo ESLM" />
    <h1>ESLM ‚Äì Composition sur terrain</h1>
  </header>
  <div class="controls">
    <label for="tactic">Tactique :</label>
    <select id="tactic">
      <option value="4-4-2">4-4-2</option>
      <option value="4-3-3">4-3-3</option>
      <option value="3-5-2">3-5-2</option>
    </select>
    <button onclick="generate()">üé≤ G√©n√©rer les √©quipes</button>
  </div>
  <div id="root"></div>

  <script type="text/babel">
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbzUsOxxiz8ePK1kKOaR2rh3LxzIjdtRvIy1wwIe-NGnjsBp7m2HQxbedWUC8m8ss7pl0A/exec";

    const placements = {
      "4-4-2": ["G", "D", "D", "D", "D", "M", "M", "M", "M", "A", "A"],
      "4-3-3": ["G", "D", "D", "D", "D", "M", "M", "M", "A", "A", "A"],
      "3-5-2": ["G", "D", "D", "D", "M", "M", "M", "M", "M", "A", "A"]
    };

    const coordinates = {
      "G": { top: "85%", lefts: [45] },
      "D": { top: "65%", lefts: [20, 35, 55, 70] },
      "M": { top: "45%", lefts: [20, 35, 50, 65, 80] },
      "A": { top: "25%", lefts: [40, 60] }
    };

    function App() {
      const [players, setPlayers] = React.useState([]);
      const [team, setTeam] = React.useState([]);
      const [subs, setSubs] = React.useState([]);
      const [tactic, setTactic] = React.useState("4-4-2");

      React.useEffect(() => {
        fetch(SHEET_URL)
          .then(res => res.json())
          .then(data => {
            const actifs = data.filter(p => String(p["pr√©sent"]).toLowerCase() === "true");
            actifs.forEach(p => p.points = parseInt(p.points) || 0);
            actifs.sort((a, b) => b.points - a.points);
            setPlayers(actifs);
          });
      }, []);

      React.useEffect(() => {
        generateTeam();
      }, [players, tactic]);

      function generateTeam() {
        const config = placements[tactic];
        const selected = players.slice(0, config.length);
        const bench = players.slice(config.length);
        const count = { G: 0, D: 0, M: 0, A: 0 };

        const positioned = selected.map((p, i) => {
          const role = config[i];
          const left = coordinates[role].lefts[count[role]] || 50;
          count[role]++;
          return {
            ...p,
            role,
            pos: { top: coordinates[role].top, left: `${left}%` }
          };
        });

        setTeam(positioned);
        setSubs(bench);
      }

      return (
        <>
          <div className="terrain">
            {team.map((p, i) => (
              <div key={i} className="player" style={{ top: p.pos.top, left: p.pos.left }}>
                {p.nom}
              </div>
            ))}
          </div>
          <div className="rempla√ßants">
            <h3>üîÅ Rempla√ßants</h3>
            {subs.map(p => <div key={p.id}>{p.nom} ({p["poste pr√©f√©r√©"]})</div>)}
          </div>
        </>
      );
    }

    function generate() {
      const val = document.getElementById("tactic").value;
      ReactDOM.render(<App key={val} />, document.getElementById("root"));
    }

    generate();
  </script>
</body>
</html>
