<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ESLM ‚Äì G√©n√©rateur d'√âquipes</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0; 
      font-family: 'Montserrat', sans-serif;
      background: #111; 
      color: #f0c300;
      overflow-x: hidden;
    }
    
    header {
      background: black; 
      padding: 15px 20px;
      display: flex; 
      align-items: center; 
      justify-content: space-between;
      flex-wrap: wrap;
    }
    
    header img { 
      height: 120px; /* Logo encore plus grand */
    }
    
    header h1 { 
      font-size: 2.4rem; 
      margin: 0; 
      color: #f0c300; 
      text-align: center;
      flex-grow: 1;
      padding: 0 15px;
      letter-spacing: 1px;
      text-shadow: 0 0 10px rgba(240, 195, 0, 0.7);
    }
    
    .container {
      display: flex; 
      flex-wrap: wrap; 
      padding: 20px; 
      gap: 20px;
      max-width: 1800px;
      margin: 0 auto;
      justify-content: center;
    }
    
    .panel {
      background: #1a1a1a; 
      border-radius: 10px; 
      padding: 20px; 
      flex: 1; 
      min-width: 300px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    
    .panel h2 { 
      margin-top: 0; 
      color: #f0c300; 
      text-align: center;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0c300;
      font-size: 1.6rem;
    }
    
    .form-group { 
      margin-bottom: 15px; 
    }
    
    label { 
      display: block; 
      margin-bottom: 5px; 
      font-weight: bold;
      color: #f0c300;
      font-size: 1.1rem;
    }
    
    select, input {
      width: 100%; 
      padding: 12px; 
      border: none;
      border-radius: 6px; 
      background: #2a2a2a; 
      color: #fff;
      font-size: 16px;
    }
    
    .btn {
      background: #f0c300; 
      color: #000;
      padding: 14px; 
      border: none; 
      font-weight: bold;
      width: 100%; 
      margin-top: 15px; 
      border-radius: 6px;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn:hover {
      background: #ffd700;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(240, 195, 0, 0.5);
    }
    
    .player-card {
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      background: #222; 
      padding: 14px; 
      border-radius: 8px;
      margin-bottom: 12px;
      transition: all 0.2s;
      border-left: 4px solid #f0c300;
      cursor: grab;
    }
    
    .player-card:hover {
      background: #2a2a2a;
      transform: translateX(5px);
      box-shadow: 0 3px 10px rgba(240, 195, 0, 0.3);
    }
    
    .player-card.dragging {
      opacity: 0.5;
      transform: scale(0.95);
    }
    
    .player-card.excluded {
      opacity: 0.6;
      background: #1a1a1a;
      border-left: 4px solid #ff5555;
    }
    
    .badge {
      display: inline-block; 
      padding: 4px 10px; 
      border-radius: 12px;
      font-size: 0.9rem; 
      margin-right: 6px;
      font-weight: bold;
    }
    
    .badge.level { 
      background: #333; 
      color: #f0c300; 
    }
    
    .badge.position { 
      background: #444; 
      color: #0cf; 
    }
    
    .badge.foot { 
      background: #333; 
      color: #fa3; 
    }
    
    .badge.present { 
      background: #2a7f2a; 
      color: #fff; 
    }
    
    .player-info {
      display: flex;
      flex-direction: column;
    }
    
    .player-name {
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 4px;
    }
    
    .player-details {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .player-section {
      margin-top: 20px;
    }
    
    .player-section h3 {
      color: #f0c300;
      border-bottom: 1px solid #333;
      padding-bottom: 8px;
      margin-top: 0;
    }
    
    /* Style pour les terrains de football - PLUS GRAND */
    .pitch-container {
      width: 100%;
      margin-top: 30px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 40px;
    }
    
    .pitch {
      position: relative;
      width: 100%;
      max-width: 800px; /* Terrain plus large */
      height: 550px; /* Terrain plus haut */
      background: #0a5f20;
      border: 4px solid #fff;
      border-radius: 10px;
      overflow: hidden;
      margin: 0 auto;
      box-shadow: 0 12px 25px rgba(0,0,0,0.7);
    }
    
    /* Lignes du terrain */
    .pitch::before {
      content: "";
      position: absolute;
      top: 0;
      left: 50%;
      width: 3px;
      height: 100%;
      background: #fff;
    }
    
    .center-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 140px;
      height: 140px;
      border: 3px solid #fff;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
    
    .penalty-area {
      position: absolute;
      width: 180px;
      height: 300px;
      border: 3px solid #fff;
    }
    
    .penalty-area.left {
      top: 50%;
      left: 0;
      transform: translateY(-50%);
      border-left: none;
      border-top-right-radius: 25px;
      border-bottom-right-radius: 25px;
    }
    
    .penalty-area.right {
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      border-right: none;
      border-top-left-radius: 25px;
      border-bottom-left-radius: 25px;
    }
    
    .goal-area {
      position: absolute;
      width: 90px;
      height: 180px;
      border: 3px solid #fff;
    }
    
    .goal-area.left {
      top: 50%;
      left: 0;
      transform: translateY(-50%);
      border-left: none;
    }
    
    .goal-area.right {
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      border-right: none;
    }
    
    .player-marker {
      position: absolute;
      min-width: 100px; /* Vignettes plus grandes */
      padding: 10px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
      text-align: center;
      transition: all 0.3s;
      z-index: 10;
      transform: translate(-50%, -50%);
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.3;
      cursor: grab;
    }
    
    .player-marker:hover {
      transform: translate(-50%, -50%) scale(1.1);
      z-index: 20;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    }
    
    .player-marker.team-a {
      background: linear-gradient(145deg, #ffd700, #f0c300);
      color: #000;
      border: 3px solid #d4af37;
    }
    
    .player-marker.team-b {
      background: linear-gradient(145deg, #333, #000);
      color: #fff;
      border: 3px solid #444;
    }
    
    .player-marker.goalkeeper {
      border: 4px solid #ff0000;
    }
    
    .marker-name {
      font-weight: bold;
      font-size: 16px;
      white-space: nowrap;
      margin-bottom: 4px;
    }
    
    .marker-foot {
      font-size: 14px;
      font-weight: bold;
      opacity: 0.9;
    }
    
    .substitutes {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .sub-player {
      min-width: 90px; /* Vignettes rempla√ßants plus grandes */
      padding: 10px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      text-align: center;
      box-shadow: 0 3px 6px rgba(0,0,0,0.4);
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.4;
      cursor: grab;
    }
    
    .sub-player.team-a {
      background: linear-gradient(145deg, #ffd700, #f0c300);
      color: #000;
      border: 3px solid #d4af37;
    }
    
    .sub-player.team-b {
      background: linear-gradient(145deg, #333, #000);
      color: #fff;
      border: 3px solid #444;
    }
    
    .team-title {
      text-align: center;
      font-size: 1.8rem;
      margin: 15px 0;
      color: #f0c300;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    .team-title .badge {
      font-size: 1.1rem;
      padding: 6px 14px;
    }
    
    .formation-selector {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .formation-btn {
      background: #2a2a2a;
      color: #f0c300;
      border: 2px solid #f0c300;
      border-radius: 8px;
      padding: 10px 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      min-width: 90px;
      text-align: center;
      font-size: 16px;
    }
    
    .formation-btn.active {
      background: #f0c300;
      color: #000;
      font-weight: bold;
    }
    
    .formation-btn:hover {
      background: #3a3a3a;
    }
    
    .penalty-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
      padding: 12px;
      background: #2a2a2a;
      border-radius: 8px;
      font-size: 16px;
    }
    
    .loading {
      text-align: center;
      padding: 30px;
      color: #f0c300;
      font-size: 20px;
    }
    
    .team-info {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      padding: 10px;
      background: #222;
      border-radius: 8px;
      font-size: 16px;
    }
    
    .error-message {
      color: #ff5555;
      text-align: center;
      padding: 10px;
      font-weight: bold;
      margin-top: 10px;
    }
    
    .drop-area {
      border: 2px dashed #f0c300;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      margin: 10px 0;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(240, 195, 0, 0.1);
    }
    
    .drop-area.active {
      background: rgba(240, 195, 0, 0.2);
    }

    /* Responsive design */
    @media (max-width: 992px) {
      .pitch {
        height: 500px;
        max-width: 700px;
      }
    }
    
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        padding: 15px;
      }
      
      .panel {
        min-width: 100%;
      }
      
      .pitch {
        height: 450px;
        max-width: 600px;
      }
      
      .player-marker {
        min-width: 90px;
        font-size: 14px;
        padding: 8px;
      }
      
      .marker-name {
        font-size: 14px;
      }
      
      header {
        flex-direction: column;
        text-align: center;
      }
      
      header h1 {
        margin: 15px 0;
        font-size: 1.8rem;
      }
      
      header img {
        height: 100px;
      }
      
      .sub-player {
        min-width: 80px;
        font-size: 13px;
      }
      
      .formation-btn {
        padding: 8px 12px;
        min-width: 80px;
        font-size: 14px;
      }
    }
    
    @media (max-width: 480px) {
      .pitch {
        height: 400px;
        max-width: 500px;
      }
      
      .player-marker {
        min-width: 80px;
        font-size: 13px;
        padding: 7px;
      }
      
      .marker-name {
        font-size: 13px;
      }
      
      .team-title {
        font-size: 1.5rem;
      }
      
      .sub-player {
        min-width: 75px;
        font-size: 12px;
      }
      
      header h1 {
        font-size: 1.6rem;
      }
      
      header img {
        height: 90px;
      }
    }
    
    /* Animation pour la g√©n√©ration */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
  </style>
</head>
<body>
  <header>
    <h1>G√©n√©rateur d'√âquipes ESLM</h1>
    <img src="https://i.postimg.cc/15j1R5RH/logo9.png" alt="Logo ESLM">
  </header>
  
  <div class="container">
    <div class="panel">
      <h2>Configuration</h2>
      <div class="form-group">
        <label for="teamCount">Nombre d'√©quipes</label>
        <select id="teamCount">
          <option value="1">1 √©quipe</option>
          <option value="2" selected>2 √©quipes</option>
        </select>
      </div>
      <div class="form-group">
        <label>Tactique</label>
        <div class="formation-selector">
          <div class="formation-btn active" data-formation="4-4-2">4-4-2</div>
          <div class="formation-btn" data-formation="3-5-2">3-5-2</div>
          <div class="formation-btn" data-formation="4-3-3">4-3-3</div>
        </div>
      </div>
      <div class="penalty-toggle">
        <input type="checkbox" id="allowPositionSwitch" checked />
        <label for="allowPositionSwitch">Permettre changement de poste</label>
      </div>
      <button class="btn" onclick="generateTeams()">
        <span>üé≤</span> G√©n√©rer les √©quipes
      </button>
    </div>
    
    <div class="panel" style="flex:2">
      <h2>Joueurs disponibles</h2>
      <div id="playersList"></div>
    </div>
  </div>
  
  <div class="container">
    <div class="panel" style="width: 100%">
      <h2>Composition des √©quipes</h2>
      <div class="pitch-container" id="teamsDisplay"></div>
    </div>
  </div>

  <script type="text/babel">
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbz-cluPQnWphcfvEhB7QSllsy-6lkJJ3Bcs0XjZ53urGjprl2VXQd5YGW1A23MBaz2hoQ/exec";

    let allPlayers = [];
    let currentFormation = "4-4-2";

    // Positions des joueurs par tactique
    const formationPositions = {
      "4-4-2": {
        G: [{x: 10, y: 50, side: "center"}],
        D: [
          {x: 25, y: 20, side: "left"},
          {x: 25, y: 40, side: "left-center"},
          {x: 25, y: 60, side: "right-center"},
          {x: 25, y: 80, side: "right"}
        ],
        M: [
          {x: 50, y: 15, side: "left"},
          {x: 50, y: 35, side: "left-center"},
          {x: 50, y: 65, side: "right-center"},
          {x: 50, y: 85, side: "right"}
        ],
        A: [
          {x: 75, y: 40, side: "left"},
          {x: 75, y: 60, side: "right"}
        ]
      },
      "3-5-2": {
        G: [{x: 10, y: 50, side: "center"}],
        D: [
          {x: 25, y: 30, side: "left"},
          {x: 25, y: 50, side: "center"},
          {x: 25, y: 70, side: "right"}
        ],
        M: [
          {x: 40, y: 20, side: "left"},
          {x: 40, y: 50, side: "center"},
          {x: 40, y: 80, side: "right"},
          {x: 60, y: 30, side: "left-offense"},
          {x: 60, y: 70, side: "right-offense"}
        ],
        A: [
          {x: 80, y: 40, side: "left"},
          {x: 80, y: 60, side: "right"}
        ]
      },
      "4-3-3": {
        G: [{x: 10, y: 50, side: "center"}],
        D: [
          {x: 25, y: 20, side: "left"},
          {x: 25, y: 40, side: "left-center"},
          {x: 25, y: 60, side: "right-center"},
          {x: 25, y: 80, side: "right"}
        ],
        M: [
          {x: 50, y: 30, side: "left"},
          {x: 50, y: 50, side: "center"},
          {x: 50, y: 70, side: "right"}
        ],
        A: [
          {x: 75, y: 20, side: "left"},
          {x: 75, y: 50, side: "center"},
          {x: 75, y: 80, side: "right"}
        ]
      }
    };

    function App() {
      const [presence, setPresence] = React.useState({});
      const [players, setPlayers] = React.useState([]);
      const [teams, setTeams] = React.useState([[], []]);
      const [teamCount, setTeamCount] = React.useState(2);
      const [formation, setFormation] = React.useState("4-4-2");
      const [allowPositionSwitch, setAllowPositionSwitch] = React.useState(true);
      const [isLoading, setIsLoading] = React.useState(true);
      const [error, setError] = React.useState(null);
      const [draggedPlayer, setDraggedPlayer] = React.useState(null);
      const [dropTarget, setDropTarget] = React.useState(null);

      React.useEffect(() => {
        setIsLoading(true);
        fetch(SHEET_URL)
          .then(res => res.json())
          .then(data => {
            allPlayers = data;
            const presentMap = {};
            data.forEach(p => presentMap[p.id] = String(p["pr√©sent"]).toLowerCase() === "true");
            setPlayers(data);
            setPresence(presentMap);
            setIsLoading(false);
          })
          .catch(err => {
            setIsLoading(false);
            setError("Erreur de chargement des joueurs");
            console.error("Erreur de chargement:", err);
          });
          
        // Initialisation des boutons de formation
        document.querySelectorAll('.formation-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            document.querySelectorAll('.formation-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            setFormation(this.dataset.formation);
          });
        });
      }, []);

      function togglePresence(id) {
        const updated = { ...presence, [id]: !presence[id] };
        setPresence(updated);
      }
      
      function handleTeamCountChange(e) {
        setTeamCount(parseInt(e.target.value));
      }
      
      function togglePositionSwitch() {
        setAllowPositionSwitch(!allowPositionSwitch);
      }

      window.generateTeams = () => {
        setError(null);
        const count = parseInt(document.getElementById('teamCount').value);
        setTeamCount(count);
        
        const actifs = players.filter(p => presence[p.id]);
        
        // V√©rifier le nombre minimal de joueurs
        if (actifs.length < (count === 1 ? 7 : 14)) {
          setError(`Pas assez de joueurs pr√©sents (${actifs.length}) pour former ${count} √©quipe${count > 1 ? 's' : ''}`);
          return;
        }
        
        // Trier par points d√©croissants pour que l'√©quipe A soit la plus forte
        const tri√©s = [...actifs].sort((a, b) => (parseInt(b.points || 0) - parseInt(a.points || 0)));
        
        // Trouver les gardiens
        const gardiens = tri√©s.filter(p => 
          p["poste pr√©f√©r√©"] && p["poste pr√©f√©r√©"].toLowerCase().includes("g")
        );
        
        let teamA = [];
        let teamB = [];
        
        if (count === 1) {
          // G√©n√©ration d'une seule √©quipe
          teamA = [...tri√©s].slice(0, Math.min(14, tri√©s.length));
        } else {
          // G√©n√©ration de deux √©quipes avec l'√©quipe A plus forte
          let sumA = 0, sumB = 0;
          
          // Placement prioritaire des gardiens
          if (gardiens.length >= 2) {
            teamA.push(gardiens[0]);
            teamB.push(gardiens[1]);
            sumA += parseInt(gardiens[0].points || 0);
            sumB += parseInt(gardiens[1].points || 0);
          } else if (gardiens.length === 1) {
            teamA.push(gardiens[0]);
            sumA += parseInt(gardiens[0].points || 0);
          }
          
          // R√©partition des autres joueurs (√©quipe A d'abord)
          tri√©s.forEach(p => {
            // Ignorer les joueurs d√©j√† plac√©s (gardiens)
            if (gardiens.includes(p)) return;
            
            // V√©rifier la taille maximale des √©quipes (11 titulaires + 3 rempla√ßants)
            if (teamA.length >= 14 && teamB.length >= 14) return;
            
            // √âquilibrer les √©quipes avec max 1 joueur de diff√©rence
            const diff = teamA.length - teamB.length;
            
            if (teamA.length < 14 && (diff <= 0 || teamB.length >= 14)) {
              teamA.push(p);
              sumA += parseInt(p.points || 0);
            } else if (teamB.length < 14) {
              teamB.push(p);
              sumB += parseInt(p.points || 0);
            }
          });
          
          // √âquilibrer les √©quipes si n√©cessaire
          const diff = Math.abs(teamA.length - teamB.length);
          if (diff > 1) {
            if (teamA.length > teamB.length) {
              const player = teamA.pop();
              teamB.push(player);
            } else {
              const player = teamB.pop();
              teamA.push(player);
            }
          }
        }
        
        setTeams([teamA, teamB]);
      };

      // Fonction pour assigner les joueurs aux postes
      const assignPlayersToPositions = (teamPlayers, formation) => {
        const positions = formationPositions[formation] || formationPositions["4-4-2"];
        const availablePlayers = [...teamPlayers];
        const assignedPlayers = [];
        const positionsList = [];
        
        // Cr√©er une liste de toutes les positions √† remplir
        for (const positionType in positions) {
          positions[positionType].forEach(pos => {
            positionsList.push({
              type: positionType,
              coords: pos,
              priority: positionType === "G" ? 1 : 
                       positionType === "D" ? 2 : 
                       positionType === "M" ? 3 : 4
            });
          });
        }
        
        // Trier par priorit√© (gardien en premier, puis d√©fense, etc.)
        positionsList.sort((a, b) => a.priority - b.priority);
        
        // Assigner les joueurs aux positions
        positionsList.forEach(posItem => {
          let bestPlayer = null;
          let bestScore = -1;
          
          // Trouver le meilleur joueur disponible pour cette position
          for (let i = 0; i < availablePlayers.length; i++) {
            const player = availablePlayers[i];
            let score = 0;
            
            // Priorit√© aux joueurs qui ont cette position en pr√©f√©r√©e
            if (player["poste pr√©f√©r√©"]?.toUpperCase().includes(posItem.type)) {
              score += 100;
            }
            
            // Ajouter les points du joueur
            score += parseInt(player.points || 0);
            
            if (score > bestScore) {
              bestScore = score;
              bestPlayer = { player, index: i };
            }
          }
          
          // Assigner le meilleur joueur trouv√© √† cette position
          if (bestPlayer) {
            assignedPlayers.push({
              player: bestPlayer.player,
              position: posItem.type,
              coords: posItem.coords
            });
            availablePlayers.splice(bestPlayer.index, 1);
          }
        });
        
        // Les joueurs restants deviennent des rempla√ßants (max 3)
        const substitutes = [...availablePlayers].slice(0, 3);
        
        return {
          titulaires: assignedPlayers,
          substitutes
        };
      };

      // Fonction pour g√©rer le drag and drop
      const handleDragStart = (e, player) => {
        e.dataTransfer.setData("playerId", player.id);
        setDraggedPlayer(player);
      };
      
      const handleDragOver = (e, target) => {
        e.preventDefault();
        setDropTarget(target);
      };
      
      const handleDrop = (e, targetType, targetTeam) => {
        e.preventDefault();
        const playerId = e.dataTransfer.getData("playerId");
        const player = players.find(p => p.id === playerId);
        
        if (player && targetType === "team") {
          // Ajouter le joueur √† l'√©quipe
          const newTeams = [...teams];
          newTeams[targetTeam] = [...newTeams[targetTeam], player];
          setTeams(newTeams);
        }
        
        setDraggedPlayer(null);
        setDropTarget(null);
      };

      // Fonction pour placer les joueurs sur le terrain
      const renderPitch = (team, teamName, teamClass, teamIndex) => {
        // Assigner les joueurs aux postes
        const { titulaires, substitutes } = assignPlayersToPositions(team, formation);
        
        return (
          <div className="fade-in" style={{width: '100%', maxWidth: '800px'}}>
            <div className="team-title">
              <span>{teamName}</span>
              <span className="badge level">{team.length} joueurs</span>
              <span className="badge position">{formation}</span>
            </div>
            
            <div 
              className="pitch"
              onDragOver={(e) => handleDragOver(e, `pitch-${teamIndex}`)}
              onDrop={(e) => handleDrop(e, "team", teamIndex)}
            >
              {/* √âl√©ments du terrain */}
              <div className="center-circle"></div>
              <div className="penalty-area left"></div>
              <div className="penalty-area right"></div>
              <div className="goal-area left"></div>
              <div className="goal-area right"></div>
              
              {/* Placement des joueurs titulaires */}
              {titulaires.map((item, index) => {
                const { player, coords } = item;
                
                return (
                  <div 
                    key={`${teamName}-${player.id}-${index}`}
                    className={`player-marker ${teamClass} ${item.position === "G" ? "goalkeeper" : ""}`}
                    style={{
                      left: `${coords.x}%`,
                      top: `${coords.y}%`,
                    }}
                    title={`${player.nom} - Pied: ${player.pied || '?'}`}
                    draggable
                    onDragStart={(e) => handleDragStart(e, player)}
                  >
                    <div className="marker-name">{player.nom}</div>
                    <div className="marker-foot">{player.pied || '?'}</div>
                  </div>
                );
              })}
            </div>
            
            {/* Rempla√ßants */}
            {substitutes.length > 0 && (
              <div className="substitutes">
                <div style={{width: '100%', textAlign: 'center', margin: '10px 0', fontSize: '16px', fontWeight: 'bold'}}>
                  Rempla√ßants ({substitutes.length})
                </div>
                {substitutes.map((player, idx) => {
                  return (
                    <div 
                      key={`sub-${teamName}-${player.id}-${idx}`}
                      className={`sub-player ${teamClass}`}
                      title={`${player.nom} - Pied: ${player.pied || '?'}`}
                      draggable
                      onDragStart={(e) => handleDragStart(e, player)}
                    >
                      <div style={{fontWeight: 'bold'}}>{player.nom}</div>
                      <div>{player.pied || '?'}</div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        );
      };

      // Joueurs exclus (non pr√©sents)
      const excludedPlayers = players.filter(p => !presence[p.id]);

      return (
        <>
          {isLoading ? (
            <div className="loading">Chargement des joueurs...</div>
          ) : error ? (
            <div className="error-message">{error}</div>
          ) : (
            <>
              <div className="container">
                <div class="panel" style={{width: '100%'}}>
                  <h2>Joueurs √©cart√©s</h2>
                  <div className="player-section">
                    {excludedPlayers.length > 0 ? (
                      <div className="drop-area"
                        onDragOver={(e) => handleDragOver(e, "excluded")}
                        onDrop={(e) => {
                          e.preventDefault();
                          setDraggedPlayer(null);
                          setDropTarget(null);
                        }}
                      >
                        {excludedPlayers.map(p => (
                          <div 
                            key={p.id} 
                            className="player-card excluded"
                            draggable
                            onDragStart={(e) => handleDragStart(e, p)}
                          >
                            <div className="player-info">
                              <div className="player-name">{p.nom}</div>
                              <div className="player-details">
                                <span className="badge level">{p.√©toiles || "?"} ‚≠ê</span>
                                <span className="badge position">{p["poste pr√©f√©r√©"] || "?"}</span>
                                <span className="badge foot">{p.pied || "?"}</span>
                                <span className="badge level">{p.points || "0"} pts</span>
                              </div>
                            </div>
                            <label>
                              <input 
                                type="checkbox" 
                                checked={presence[p.id] || false} 
                                onChange={() => togglePresence(p.id)} 
                              />
                              <span className="badge present">Pr√©sent</span>
                            </label>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <div className="drop-area">
                        Aucun joueur √©cart√©. Tous les joueurs sont pr√©sents.
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </>
          )}
        </>
      );
    }

    ReactDOM.render(<App />, document.body.appendChild(document.createElement('div')));
  </script>
</body>
</html>
