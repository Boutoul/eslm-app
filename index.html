<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ESLM ‚Äì G√©n√©rateur d'√âquipes</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0; 
      font-family: 'Montserrat', sans-serif;
      background: #111; 
      color: #f0c300;
      overflow-x: hidden;
    }
    
    header {
      background: black; 
      padding: 15px 20px;
      display: flex; 
      align-items: center; 
      justify-content: space-between;
      flex-wrap: wrap;
    }
    
    header img { 
      height: 70px;
    }
    
    header h1 { 
      font-size: 1.8rem; 
      margin: 0; 
      color: #f0c300; 
      text-align: center;
      flex-grow: 1;
      padding: 0 15px;
    }
    
    .container {
      display: flex; 
      flex-wrap: wrap; 
      padding: 20px; 
      gap: 20px;
      max-width: 1600px;
      margin: 0 auto;
      justify-content: center;
    }
    
    .panel {
      background: #1a1a1a; 
      border-radius: 10px; 
      padding: 20px; 
      flex: 1; 
      min-width: 300px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    
    .panel h2 { 
      margin-top: 0; 
      color: #f0c300; 
      text-align: center;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0c300;
    }
    
    .form-group { 
      margin-bottom: 15px; 
    }
    
    label { 
      display: block; 
      margin-bottom: 5px; 
      font-weight: bold;
      color: #f0c300;
    }
    
    select, input {
      width: 100%; 
      padding: 10px; 
      border: none;
      border-radius: 6px; 
      background: #2a2a2a; 
      color: #fff;
      font-size: 16px;
    }
    
    .btn {
      background: #f0c300; 
      color: #000;
      padding: 12px; 
      border: none; 
      font-weight: bold;
      width: 100%; 
      margin-top: 10px; 
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn:hover {
      background: #ffd700;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(240, 195, 0, 0.3);
    }
    
    .player-card {
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      background: #222; 
      padding: 12px; 
      border-radius: 8px;
      margin-bottom: 10px;
      transition: all 0.2s;
      border-left: 4px solid #f0c300;
    }
    
    .player-card:hover {
      background: #2a2a2a;
      transform: translateX(5px);
      box-shadow: 0 3px 8px rgba(240, 195, 0, 0.2);
    }
    
    .badge {
      display: inline-block; 
      padding: 3px 8px; 
      border-radius: 12px;
      font-size: 0.8rem; 
      margin-right: 5px;
      font-weight: bold;
    }
    
    .badge.level { 
      background: #333; 
      color: #f0c300; 
    }
    
    .badge.position { 
      background: #444; 
      color: #0cf; 
    }
    
    .badge.foot { 
      background: #333; 
      color: #fa3; 
    }
    
    .badge.present { 
      background: #2a7f2a; 
      color: #fff; 
    }
    
    /* Style pour les terrains de football */
    .pitch-container {
      width: 100%;
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
    }
    
    .pitch {
      position: relative;
      width: 100%;
      max-width: 500px;
      height: 350px;
      background: #0a5f20;
      border: 3px solid #fff;
      border-radius: 8px;
      overflow: hidden;
      margin: 0 auto;
      box-shadow: 0 10px 20px rgba(0,0,0,0.5);
    }
    
    /* Lignes du terrain */
    .pitch::before {
      content: "";
      position: absolute;
      top: 0;
      left: 50%;
      width: 2px;
      height: 100%;
      background: #fff;
    }
    
    .center-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 80px;
      height: 80px;
      border: 2px solid #fff;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
    
    .penalty-area {
      position: absolute;
      width: 120px;
      height: 200px;
      border: 2px solid #fff;
    }
    
    .penalty-area.left {
      top: 50%;
      left: 0;
      transform: translateY(-50%);
      border-left: none;
      border-top-right-radius: 20px;
      border-bottom-right-radius: 20px;
    }
    
    .penalty-area.right {
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      border-right: none;
      border-top-left-radius: 20px;
      border-bottom-left-radius: 20px;
    }
    
    .goal-area {
      position: absolute;
      width: 60px;
      height: 120px;
      border: 2px solid #fff;
    }
    
    .goal-area.left {
      top: 50%;
      left: 0;
      transform: translateY(-50%);
      border-left: none;
    }
    
    .goal-area.right {
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      border-right: none;
    }
    
    .player-marker {
      position: absolute;
      min-width: 70px;
      padding: 6px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 12px;
      text-align: center;
      transition: all 0.3s;
      z-index: 10;
      transform: translate(-50%, -50%);
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.3);
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.2;
    }
    
    .player-marker:hover {
      transform: translate(-50%, -50%) scale(1.1);
      z-index: 20;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    
    .player-marker.team-a {
      background: linear-gradient(145deg, #ffd700, #f0c300);
      color: #000;
      border: 2px solid #d4af37;
    }
    
    .player-marker.team-b {
      background: linear-gradient(145deg, #333, #000);
      color: #fff;
      border: 2px solid #444;
    }
    
    .player-marker.goalkeeper {
      border: 3px solid #ff0000;
    }
    
    .player-marker.secondary {
      border: 2px dashed #ff00ff;
    }
    
    .player-name {
      font-weight: bold;
      font-size: 12px;
      white-space: nowrap;
      margin-bottom: 3px;
    }
    
    .player-foot {
      font-size: 11px;
      font-weight: bold;
      opacity: 0.9;
    }
    
    .substitutes {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .sub-player {
      min-width: 65px;
      padding: 6px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.3;
    }
    
    .sub-player.team-a {
      background: linear-gradient(145deg, #ffd700, #f0c300);
      color: #000;
      border: 2px solid #d4af37;
    }
    
    .sub-player.team-b {
      background: linear-gradient(145deg, #333, #000);
      color: #fff;
      border: 2px solid #444;
    }
    
    .team-title {
      text-align: center;
      font-size: 1.5rem;
      margin: 10px 0;
      color: #f0c300;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    .team-title .badge {
      font-size: 1rem;
      padding: 5px 12px;
    }
    
    .formation-selector {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    
    .formation-btn {
      background: #2a2a2a;
      color: #f0c300;
      border: 2px solid #f0c300;
      border-radius: 6px;
      padding: 8px 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      min-width: 80px;
      text-align: center;
    }
    
    .formation-btn.active {
      background: #f0c300;
      color: #000;
      font-weight: bold;
    }
    
    .formation-btn:hover {
      background: #3a3a3a;
    }
    
    .penalty-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
      padding: 10px;
      background: #2a2a2a;
      border-radius: 6px;
    }
    
    .team-strength {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      padding: 8px;
      background: #222;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .foot-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      text-align: center;
      line-height: 16px;
      border-radius: 50%;
      margin-right: 3px;
      font-size: 12px;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        padding: 10px;
      }
      
      .panel {
        min-width: 100%;
      }
      
      .pitch {
        height: 300px;
      }
      
      .player-marker {
        min-width: 60px;
        font-size: 11px;
        padding: 5px;
      }
      
      .player-name {
        font-size: 11px;
      }
      
      header {
        flex-direction: column;
        text-align: center;
      }
      
      header h1 {
        margin: 10px 0;
        font-size: 1.5rem;
      }
      
      .sub-player {
        min-width: 55px;
        font-size: 10px;
      }
      
      .formation-btn {
        padding: 6px 10px;
        min-width: 70px;
      }
    }
    
    @media (max-width: 480px) {
      .pitch {
        height: 250px;
      }
      
      .player-marker {
        min-width: 50px;
        font-size: 10px;
        padding: 4px;
      }
      
      .player-name {
        font-size: 10px;
      }
      
      .team-title {
        font-size: 1.2rem;
      }
      
      .sub-player {
        min-width: 50px;
        font-size: 9px;
      }
    }
    
    /* Animation pour la g√©n√©ration */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: #f0c300;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <header>
    <h1>G√©n√©rateur d'√âquipes ESLM</h1>
    <img src="https://i.postimg.cc/15j1R5RH/logo9.png" alt="Logo ESLM">
  </header>
  
  <div class="container">
    <div class="panel">
      <h2>Configuration</h2>
      <div class="form-group">
        <label for="teamCount">Nombre d'√©quipes</label>
        <select id="teamCount">
          <option value="1">1 √©quipe</option>
          <option value="2" selected>2 √©quipes</option>
        </select>
      </div>
      <div class="form-group">
        <label for="teamSize">Taille max. par √©quipe</label>
        <input type="number" id="teamSize" value="11" min="5" max="15" />
      </div>
      <div class="form-group">
        <label>Tactique</label>
        <div class="formation-selector">
          <div class="formation-btn active" data-formation="4-4-2">4-4-2</div>
          <div class="formation-btn" data-formation="3-5-2">3-5-2</div>
          <div class="formation-btn" data-formation="4-3-3">4-3-3</div>
        </div>
      </div>
      <div class="penalty-toggle">
        <input type="checkbox" id="allowPositionSwitch" checked />
        <label for="allowPositionSwitch">Permettre changement de poste</label>
      </div>
      <button class="btn" onclick="generateTeams()">
        <span>üé≤</span> G√©n√©rer les √©quipes
      </button>
    </div>
    
    <div class="panel" style="flex:2">
      <h2>Joueurs disponibles</h2>
      <div id="playersList"></div>
    </div>
  </div>
  
  <div class="container">
    <div class="pitch-container" id="teamsDisplay"></div>
  </div>

  <script type="text/babel">
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbz-cluPQnWphcfvEhB7QSllsy-6lkJJ3Bcs0XjZ53urGjprl2VXQd5YGW1A23MBaz2hoQ/exec";

    let allPlayers = [];
    let currentFormation = "4-4-2";

    // Positions des joueurs par tactique
    const formationPositions = {
      "4-4-2": {
        G: [{x: 10, y: 50, side: "center"}],
        D: [
          {x: 25, y: 20, side: "left"},
          {x: 25, y: 40, side: "left-center"},
          {x: 25, y: 60, side: "right-center"},
          {x: 25, y: 80, side: "right"}
        ],
        M: [
          {x: 50, y: 15, side: "left"},
          {x: 50, y: 35, side: "left-center"},
          {x: 50, y: 65, side: "right-center"},
          {x: 50, y: 85, side: "right"}
        ],
        A: [
          {x: 75, y: 40, side: "left"},
          {x: 75, y: 60, side: "right"}
        ]
      },
      "3-5-2": {
        G: [{x: 10, y: 50, side: "center"}],
        D: [
          {x: 25, y: 30, side: "left"},
          {x: 25, y: 50, side: "center"},
          {x: 25, y: 70, side: "right"}
        ],
        M: [
          {x: 40, y: 20, side: "left"},
          {x: 40, y: 50, side: "center"},
          {x: 40, y: 80, side: "right"},
          {x: 60, y: 30, side: "left-offense"},
          {x: 60, y: 70, side: "right-offense"}
        ],
        A: [
          {x: 80, y: 40, side: "left"},
          {x: 80, y: 60, side: "right"}
        ]
      },
      "4-3-3": {
        G: [{x: 10, y: 50, side: "center"}],
        D: [
          {x: 25, y: 20, side: "left"},
          {x: 25, y: 40, side: "left-center"},
          {x: 25, y: 60, side: "right-center"},
          {x: 25, y: 80, side: "right"}
        ],
        M: [
          {x: 50, y: 30, side: "left"},
          {x: 50, y: 50, side: "center"},
          {x: 50, y: 70, side: "right"}
        ],
        A: [
          {x: 75, y: 20, side: "left"},
          {x: 75, y: 50, side: "center"},
          {x: 75, y: 80, side: "right"}
        ]
      }
    };

    function App() {
      const [presence, setPresence] = React.useState({});
      const [players, setPlayers] = React.useState([]);
      const [teams, setTeams] = React.useState([[], []]);
      const [teamCount, setTeamCount] = React.useState(2);
      const [teamSize, setTeamSize] = React.useState(11);
      const [formation, setFormation] = React.useState("4-4-2");
      const [allowPositionSwitch, setAllowPositionSwitch] = React.useState(true);
      const [isLoading, setIsLoading] = React.useState(true);

      React.useEffect(() => {
        setIsLoading(true);
        fetch(SHEET_URL)
          .then(res => res.json())
          .then(data => {
            allPlayers = data;
            const presentMap = {};
            data.forEach(p => presentMap[p.id] = String(p["pr√©sent"]).toLowerCase() === "true");
            setPlayers(data);
            setPresence(presentMap);
            setIsLoading(false);
          })
          .catch(() => {
            setIsLoading(false);
          });
          
        // Initialisation des boutons de formation
        document.querySelectorAll('.formation-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            document.querySelectorAll('.formation-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            setFormation(this.dataset.formation);
          });
        });
      }, []);

      function togglePresence(id) {
        const updated = { ...presence, [id]: !presence[id] };
        setPresence(updated);
      }
      
      function handleTeamCountChange(e) {
        setTeamCount(parseInt(e.target.value));
      }
      
      function handleTeamSizeChange(e) {
        const size = Math.max(5, Math.min(15, parseInt(e.target.value) || 11));
        setTeamSize(size);
      }
      
      function togglePositionSwitch() {
        setAllowPositionSwitch(!allowPositionSwitch);
      }

      window.generateTeams = () => {
        const count = parseInt(document.getElementById('teamCount').value);
        const size = parseInt(document.getElementById('teamSize').value);
        setTeamCount(count);
        setTeamSize(size);
        
        const actifs = players.filter(p => presence[p.id]);
        
        // Trier par points d√©croissants pour que l'√©quipe A soit la plus forte
        const tri√©s = [...actifs].sort((a, b) => (parseInt(b.points || 0) - parseInt(a.points || 0)));
        
        // Trouver les gardiens
        const gardiens = tri√©s.filter(p => 
          p["poste pr√©f√©r√©"] && p["poste pr√©f√©r√©"].toLowerCase().includes("g")
        );
        
        let teamA = [];
        let teamB = [];
        
        if (count === 1) {
          // G√©n√©ration d'une seule √©quipe
          teamA = [...tri√©s].slice(0, Math.min(size, tri√©s.length));
        } else {
          // G√©n√©ration de deux √©quipes avec l'√©quipe A plus forte
          let sumA = 0, sumB = 0;
          
          // Placement prioritaire des gardiens
          if (gardiens.length >= 2) {
            teamA.push(gardiens[0]);
            teamB.push(gardiens[1]);
            sumA += parseInt(gardiens[0].points || 0);
            sumB += parseInt(gardiens[1].points || 0);
          } else if (gardiens.length === 1) {
            teamA.push(gardiens[0]);
            sumA += parseInt(gardiens[0].points || 0);
          }
          
          // R√©partition des autres joueurs (√©quipe A d'abord)
          tri√©s.forEach(p => {
            // Ignorer les joueurs d√©j√† plac√©s (gardiens)
            if (gardiens.includes(p)) return;
            
            // V√©rifier la taille maximale des √©quipes
            if (teamA.length >= size && teamB.length >= size) return;
            
            // √âquilibrer les √©quipes avec max 1 joueur de diff√©rence
            const diff = teamA.length - teamB.length;
            
            if (teamA.length < size && (diff <= 0 || teamB.length >= size)) {
              teamA.push(p);
              sumA += parseInt(p.points || 0);
            } else if (teamB.length < size) {
              teamB.push(p);
              sumB += parseInt(p.points || 0);
            }
          });
          
          // √âquilibrer les √©quipes si n√©cessaire
          const diff = Math.abs(teamA.length - teamB.length);
          if (diff > 1) {
            if (teamA.length > teamB.length) {
              const player = teamA.pop();
              teamB.push(player);
            } else {
              const player = teamB.pop();
              teamA.push(player);
            }
          }
        }
        
        setTeams([teamA, teamB]);
      };

      // Fonction pour assigner les joueurs aux postes
      const assignPlayersToPositions = (teamPlayers, formation) => {
        const positions = formationPositions[formation] || formationPositions["4-4-2"];
        const availablePlayers = [...teamPlayers];
        const assignedPlayers = {
          G: [],
          D: [],
          M: [],
          A: []
        };
        
        // Fonction pour trouver le meilleur joueur pour un poste avec prise en compte du pied
        const findBestPlayerForPosition = (position, side) => {
          // Trouver les joueurs qui ont ce poste en pr√©f√©r√©
          const primaryPlayers = availablePlayers.filter(p => 
            p["poste pr√©f√©r√©"]?.toUpperCase().includes(position)
          );
          
          if (primaryPlayers.length > 0) {
            // Trier par niveau (points)
            primaryPlayers.sort((a, b) => parseInt(b.points || 0) - parseInt(a.points || 0));
            return primaryPlayers[0];
          }
          
          // Si on permet le changement de poste
          if (allowPositionSwitch) {
            // Prendre le meilleur joueur disponible
            const sortedPlayers = [...availablePlayers].sort((a, b) => parseInt(b.points || 0) - parseInt(a.points || 0));
            if (sortedPlayers.length > 0) {
              return sortedPlayers[0];
            }
          }
          
          return null;
        };
        
        // Assigner les gardiens en premier
        if (positions.G.length > 0) {
          const goalie = findBestPlayerForPosition("G", "center");
          if (goalie) {
            assignedPlayers.G.push(goalie);
            const index = availablePlayers.findIndex(p => p.id === goalie.id);
            if (index !== -1) availablePlayers.splice(index, 1);
          }
        }
        
        // Assigner les d√©fenseurs
        positions.D.forEach(pos => {
          const defender = findBestPlayerForPosition("D", pos.side);
          if (defender) {
            assignedPlayers.D.push(defender);
            const index = availablePlayers.findIndex(p => p.id === defender.id);
            if (index !== -1) availablePlayers.splice(index, 1);
          }
        });
        
        // Assigner les milieux
        positions.M.forEach(pos => {
          const midfielder = findBestPlayerForPosition("M", pos.side);
          if (midfielder) {
            assignedPlayers.M.push(midfielder);
            const index = availablePlayers.findIndex(p => p.id === midfielder.id);
            if (index !== -1) availablePlayers.splice(index, 1);
          }
        });
        
        // Assigner les attaquants
        positions.A.forEach(pos => {
          const attacker = findBestPlayerForPosition("A", pos.side);
          if (attacker) {
            assignedPlayers.A.push(attacker);
            const index = availablePlayers.findIndex(p => p.id === attacker.id);
            if (index !== -1) availablePlayers.splice(index, 1);
          }
        });
        
        // Les joueurs restants deviennent des rempla√ßants
        const substitutes = [...availablePlayers];
        
        return {
          titulaires: [
            ...assignedPlayers.G,
            ...assignedPlayers.D,
            ...assignedPlayers.M,
            ...assignedPlayers.A
          ],
          substitutes
        };
      };

      // Fonction pour placer les joueurs sur le terrain
      const renderPitch = (team, teamName, teamClass) => {
        // Assigner les joueurs aux postes
        const { titulaires, substitutes } = assignPlayersToPositions(team, formation);
        const positions = formationPositions[formation] || formationPositions["4-4-2"];
        
        return (
          <div className="fade-in" style={{width: '100%', maxWidth: '500px'}}>
            <div className="team-title">
              <span>{teamName}</span>
              <span className="badge level">{team.length} joueurs</span>
              <span className="badge position">{formation}</span>
            </div>
            
            <div className="pitch">
              {/* √âl√©ments du terrain */}
              <div className="center-circle"></div>
              <div className="penalty-area left"></div>
              <div className="penalty-area right"></div>
              <div className="goal-area left"></div>
              <div className="goal-area right"></div>
              
              {/* Placement des joueurs titulaires */}
              {positions.G.map((posCoord, idx) => {
                const player = titulaires.find(p => 
                  p["poste pr√©f√©r√©"]?.toUpperCase().includes("G")
                ) || titulaires[idx];
                if (!player) return null;
                
                return (
                  <div 
                    key={`${teamName}-${player.id}`}
                    className={`player-marker ${teamClass} goalkeeper`}
                    style={{
                      left: `${posCoord.x}%`,
                      top: `${posCoord.y}%`,
                    }}
                    title={`${player.nom} - ${player.pied || '?'}`}
                  >
                    <div className="player-name">{player.nom}</div>
                    <div className="player-foot">{player.pied || '?'}</div>
                  </div>
                );
              })}
              
              {positions.D.map((posCoord, idx) => {
                // Trouver le joueur assign√© √† cette position
                const player = titulaires.find(p => 
                  p["poste pr√©f√©r√©"]?.toUpperCase().includes("D")
                ) || titulaires[idx + positions.G.length];
                
                if (!player) return null;
                
                return (
                  <div 
                    key={`${teamName}-${player.id}-${idx}`}
                    className={`player-marker ${teamClass}`}
                    style={{
                      left: `${posCoord.x}%`,
                      top: `${posCoord.y}%`,
                    }}
                    title={`${player.nom} - ${player.pied || '?'}`}
                  >
                    <div className="player-name">{player.nom}</div>
                    <div className="player-foot">{player.pied || '?'}</div>
                  </div>
                );
              })}
              
              {positions.M.map((posCoord, idx) => {
                const player = titulaires.find(p => 
                  p["poste pr√©f√©r√©"]?.toUpperCase().includes("M")
                ) || titulaires[idx + positions.G.length + positions.D.length];
                
                if (!player) return null;
                
                return (
                  <div 
                    key={`${teamName}-${player.id}-${idx}`}
                    className={`player-marker ${teamClass}`}
                    style={{
                      left: `${posCoord.x}%`,
                      top: `${posCoord.y}%`,
                    }}
                    title={`${player.nom} - ${player.pied || '?'}`}
                  >
                    <div className="player-name">{player.nom}</div>
                    <div className="player-foot">{player.pied || '?'}</div>
                  </div>
                );
              })}
              
              {positions.A.map((posCoord, idx) => {
                const player = titulaires.find(p => 
                  p["poste pr√©f√©r√©"]?.toUpperCase().includes("A")
                ) || titulaires[idx + positions.G.length + positions.D.length + positions.M.length];
                
                if (!player) return null;
                
                return (
                  <div 
                    key={`${teamName}-${player.id}-${idx}`}
                    className={`player-marker ${teamClass}`}
                    style={{
                      left: `${posCoord.x}%`,
                      top: `${posCoord.y}%`,
                    }}
                    title={`${player.nom} - ${player.pied || '?'}`}
                  >
                    <div className="player-name">{player.nom}</div>
                    <div className="player-foot">{player.pied || '?'}</div>
                  </div>
                );
              })}
            </div>
            
            {/* Rempla√ßants */}
            {substitutes.length > 0 && (
              <div className="substitutes">
                <div style={{width: '100%', textAlign: 'center', margin: '5px 0', fontSize: '14px', fontWeight: 'bold'}}>
                  Rempla√ßants
                </div>
                {substitutes.slice(0, 3).map((player, idx) => {
                  return (
                    <div 
                      key={`sub-${teamName}-${player.id}-${idx}`}
                      className={`sub-player ${teamClass}`}
                      title={`${player.nom} - ${player.pied || '?'}`}
                    >
                      <div style={{fontWeight: 'bold'}}>{player.nom}</div>
                      <div>{player.pied || '?'}</div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        );
      };

      return (
        <>
          {isLoading ? (
            <div className="loading">Chargement des joueurs...</div>
          ) : (
            <>
              {players.map(p => (
                <div key={p.id} className="player-card">
                  <div>
                    <strong>{p.nom}</strong>
                    <div style={{marginTop: '5px'}}>
                      <span className="badge level">{p.√©toiles || "?"} ‚≠ê</span>
                      <span className="badge position">{p["poste pr√©f√©r√©"] || "?"}</span>
                      <span className="badge foot">{p.pied || "?"}</span>
                      <span className="badge level">{p.points || "0"} pts</span>
                    </div>
                  </div>
                  <label>
                    <input 
                      type="checkbox" 
                      checked={presence[p.id] || false} 
                      onChange={() => togglePresence(p.id)} 
                    />
                    <span className="badge present">Pr√©sent</span>
                  </label>
                </div>
              ))}
              
              <div className="pitch-container">
                {teams[0].length > 0 && renderPitch(teams[0], "üü° √âquipe A", "team-a")}
                {teamCount === 2 && teams[1].length > 0 && renderPitch(teams[1], "‚ö´ √âquipe B", "team-b")}
              </div>
              
              <div className="form-group" style={{marginTop: '20px'}}>
                <label htmlFor="teamCountSelect">Nombre d'√©quipes</label>
                <select 
                  id="teamCountSelect" 
                  value={teamCount} 
                  onChange={handleTeamCountChange}
                  style={{marginBottom: '15px'}}
                >
                  <option value={1}>1 √©quipe</option>
                  <option value={2}>2 √©quipes</option>
                </select>
                
                <label htmlFor="teamSizeInput">Taille max. par √©quipe</label>
                <input 
                  type="number" 
                  id="teamSizeInput" 
                  value={teamSize} 
                  min="5" 
                  max="15" 
                  onChange={handleTeamSizeChange}
                />
                
                <div className="formation-selector">
                  <div className={`formation-btn ${formation === "4-4-2" ? "active" : ""}`} data-formation="4-4-2">4-4-2</div>
                  <div className={`formation-btn ${formation === "3-5-2" ? "active" : ""}`} data-formation="3-5-2">3-5-2</div>
                  <div className={`formation-btn ${formation === "4-3-3" ? "active" : ""}`} data-formation="4-3-3">4-3-3</div>
                </div>
                
                <div className="penalty-toggle">
                  <input 
                    type="checkbox" 
                    id="positionSwitchInput" 
                    checked={allowPositionSwitch} 
                    onChange={togglePositionSwitch}
                  />
                  <label htmlFor="positionSwitchInput">Permettre changement de poste</label>
                </div>
                
                <button className="btn" onClick={generateTeams}>
                  <span>üé≤</span> G√©n√©rer les √©quipes
                </button>
              </div>
            </>
          )}
        </>
      );
    }

    ReactDOM.render(<App />, document.body.appendChild(document.createElement('div')));
  </script>
</body>
</html>
