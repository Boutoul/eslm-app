<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ESLM ‚Äì Composition terrain</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      margin: 0; font-family: Arial; background: #111; color: yellow;
    }
    header {
      display: flex; align-items: center; background: black; padding: 10px;
    }
    header img {
      height: 40px; margin-right: 10px;
    }
    .controls {
      display: flex; flex-wrap: wrap; gap: 10px; background: #222; padding: 10px;
    }
    .controls select, .controls button {
      padding: 5px 10px; font-size: 16px;
    }
    .terrain {
      position: relative;
      background: url('https://i.postimg.cc/k4jZTVr8/terrain-pro.png') no-repeat center center;
      background-size: cover;
      height: 500px;
      margin: 10px;
      border: 2px solid yellow;
    }
    .player {
      position: absolute;
      background: black;
      color: yellow;
      border: 1px solid yellow;
      border-radius: 5px;
      font-size: 12px;
      padding: 4px 6px;
      text-align: center;
      max-width: 80px;
      transform: translate(-50%, -50%);
    }
    .subs {
      background: #222; padding: 10px; margin: 10px;
    }
    @media (max-width: 600px) {
      .terrain { height: 300px; }
      .player { font-size: 10px; }
    }
  </style>
</head>
<body>
  <header>
    <img src="https://i.postimg.cc/15j1R5RH/logo9.png" alt="Logo ESLM">
    <h1>ESLM ‚Äì Terrain et Compo</h1>
  </header>

  <div class="controls">
    <label>Tactique :</label>
    <select id="tacticSelect">
      <option value="4-4-2">4-4-2</option>
      <option value="4-3-3">4-3-3</option>
      <option value="3-5-2">3-5-2</option>
    </select>
    <button onclick="generate()">üé≤ G√©n√©rer</button>
  </div>

  <div id="root">Chargement‚Ä¶</div>

  <script type="text/babel">
    const TACTICS = {
      "4-4-2": ["G", "D", "D", "D", "D", "M", "M", "M", "M", "A", "A"],
      "4-3-3": ["G", "D", "D", "D", "D", "M", "M", "M", "A", "A", "A"],
      "3-5-2": ["G", "D", "D", "D", "M", "M", "M", "M", "M", "A", "A"]
    };

    const POSITIONS = {
      G: { top: 90 },
      D: { top: 70 },
      M: { top: 50 },
      A: { top: 30 }
    };

    const SHEET_URL = "https://script.google.com/macros/s/AKfycbzUsOxxiz8ePK1kKOaR2rh3LxzIjdtRvIy1wwIe-NGnjsBp7m2HQxbedWUC8m8ss7pl0A/exec";

    function App() {
      const [players, setPlayers] = React.useState([]);
      const [tactic, setTactic] = React.useState("4-4-2");

      React.useEffect(() => {
        fetch(SHEET_URL)
          .then(res => res.json())
          .then(data => {
            const actifs = data.filter(p => String(p["pr√©sent"]).toLowerCase() === "true");
            actifs.forEach(p => p.points = parseInt(p.points) || 0);
            actifs.sort((a, b) => b.points - a.points);
            setPlayers(actifs);
          });
      }, []);

      const assignPlayers = () => {
        const compo = TACTICS[tactic];
        const titulaires = [];
        const rempla√ßants = [];
        const posteMap = { Gardien: "G", D√©fenseur: "D", Milieu: "M", Attaquant: "A" };

        // Placer gardien s'il existe
        const gardien = players.find(p => p["poste pr√©f√©r√©"] === "Gardien");
        if (gardien) {
          titulaires.push({ ...gardien, poste: "G" });
        }

        const restants = players.filter(p => p.id !== gardien?.id);

        compo.forEach(pos => {
          if (pos === "G" && gardien) return;
          const pr√©f√©r√©s = restants.find(p => posteMap[p["poste pr√©f√©r√©"]] === pos);
          const accept√©s = restants.find(p => String(p[`${pos.toLowerCase()} accept√©`]).toLowerCase() === "true");

          const choisi = pr√©f√©r√©s || accept√©s;
          if (choisi) {
            titulaires.push({ ...choisi, poste: pos });
            const index = restants.findIndex(p => p.id === choisi.id);
            if (index !== -1) restants.splice(index, 1);
          }
        });

        return { titulaires, rempla√ßants: restants };
      };

      const { titulaires, rempla√ßants } = assignPlayers();
      const posteCount = { G: 0, D: 0, M: 0, A: 0 };

      return (
        <>
          <div className="terrain">
            {titulaires.map((p, i) => {
              const poste = p.poste;
              const count = posteCount[poste]++;
              const left = 15 + count * 20;
              return (
                <div key={i} className="player" style={{ top: POSITIONS[poste].top + "%", left: left + "%" }}>
                  {p.nom}
                </div>
              );
            })}
          </div>
          <div className="subs">
            <h3>üîÅ Rempla√ßants</h3>
            {rempla√ßants.map(p => (
              <div key={p.id}>{p.nom} ({p["poste pr√©f√©r√©"]})</div>
            ))}
          </div>
        </>
      );
    }

    function generate() {
      const val = document.getElementById("tacticSelect").value;
      ReactDOM.render(<App key={val} />, document.getElementById("root"));
    }

    generate();
  </script>
</body>
</html>
