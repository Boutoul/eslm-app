<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ESLM - Composition d'Ã©quipes</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 20px; }
    h1 { background: black; color: yellow; padding: 10px; }
    .teams { display: flex; gap: 20px; margin-top: 20px; }
    .team { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1); flex: 1; }
    .player { padding: 4px 0; border-bottom: 1px solid #eee; }
    button { margin-top: 10px; padding: 10px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>âš½ ESLM â€“ Composition automatique des Ã©quipes</h1>
  <div id="root">Chargementâ€¦</div>

  <script type="text/babel">
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbzUsOxxiz8ePK1kKOaR2rh3LxzIjdtRvIy1wwIe-NGnjsBp7m2HQxbedWUC8m8ss7pl0A/exec";

    function App() {
      const [players, setPlayers] = React.useState([]);
      const [equipes, setEquipes] = React.useState([[], []]);

      React.useEffect(() => {
        fetch(SHEET_URL)
          .then(res => res.json())
          .then(data => {
            const actifs = data.filter(p => String(p["prÃ©sent"]).toLowerCase() === "true");
            actifs.forEach(p => p.points = parseInt(p.points) || 0);
            setPlayers(actifs);
          });
      }, []);

      function composerEquipes() {
        const joueurs = [...players].sort((a, b) => b.points - a.points);
        const teamA = [], teamB = [];
        let totalA = 0, totalB = 0;

        joueurs.forEach(joueur => {
          if (totalA <= totalB) {
            teamA.push(joueur);
            totalA += joueur.points;
          } else {
            teamB.push(joueur);
            totalB += joueur.points;
          }
        });

        setEquipes([teamA, teamB]);
      }

      return (
        <div>
          <button onClick={composerEquipes}>ðŸŽ² Composer automatiquement les Ã©quipes</button>
          <div className="teams">
            <div className="team">
              <h3>ðŸŸ¡ Ã‰quipe A</h3>
              {equipes[0].map(p => (
                <div key={p.id} className="player">{p.nom} ({p.points} pts) â€“ {p.pied}</div>
              ))}
            </div>
            <div className="team">
              <h3>âš« Ã‰quipe B</h3>
              {equipes[1].map(p => (
                <div key={p.id} className="player">{p.nom} ({p.points} pts) â€“ {p.pied}</div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
